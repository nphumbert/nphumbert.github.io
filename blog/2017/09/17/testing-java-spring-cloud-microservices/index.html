<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Testing Java Spring Boot Microservices</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Entrepreneur, consultant, bio-sciences and software engineer."><meta name=author content="Nadia Humbert-Labeaumaz"><meta name=generator content="Hugo 0.131.0"><meta property="og:image" content="https://nphumbert.github.io/images/blog/testing-microservices/header.jpg"><meta property="og:url" content="https://nphumbert.github.io/blog/2017/09/17/testing-java-spring-cloud-microservices/"><meta property="og:site_name" content="Nadia Humbert-Labeaumaz"><meta property="og:title" content="Testing Java Spring Boot Microservices"><meta property="og:description" content="Tests are an essential part of our codebase. At the very least, they minimize the risk of regression when we modify our code. There are several types of tests, and each has a specific role: unit tests, integration tests, component tests, contract tests and end-to-end tests. Therefore, it is crucial to understand the role of each type of test to leverage its potential.
This article describes a strategy to use them to test Java Spring Boot microservices. It presents each type of test’s role, scope, and tooling."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2017-09-17T16:09:24+02:00"><meta property="article:modified_time" content="2017-09-17T16:09:24+02:00"><meta property="article:tag" content="Software Testing"><meta property="article:tag" content="Software Design"><meta property="article:tag" content="Java"><meta property="og:image" content="https://nphumbert.github.io/images/slider.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nphumbert.github.io/images/slider.jpg"><meta name=twitter:title content="Testing Java Spring Boot Microservices"><meta name=twitter:description content="Tests are an essential part of our codebase. At the very least, they minimize the risk of regression when we modify our code. There are several types of tests, and each has a specific role: unit tests, integration tests, component tests, contract tests and end-to-end tests. Therefore, it is crucial to understand the role of each type of test to leverage its potential.
This article describes a strategy to use them to test Java Spring Boot microservices. It presents each type of test’s role, scope, and tooling."><script async src="https://www.googletagmanager.com/gtag/js?id=G-FDXGPB3FE3"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FDXGPB3FE3")}</script><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css media=screen><link rel=stylesheet href=/plugins/ionicons/css/ionicons.min.css><link rel=stylesheet href=/plugins/magnific-popup/magnific-popup.min.css><link rel=stylesheet href=/plugins/slick/slick.css><link rel=stylesheet href=/scss/style.min.css media=screen><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=icon href=/images/favicon.png type=image/x-icon><link rel=canonical href=https://nphumbert.github.io/blog/2017/09/17/testing-java-spring-cloud-microservices/></head><body><div class=preloader></div><header class=navigation><div class=container><div class=row><div class=col-md-12><nav class=navbar><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navigation>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse" id=navigation><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Articles</a></li></ul></div></nav></div></div></div></header><section class="page-title bg-2" style=background-image:url(/images/blog/testing-microservices/header.jpg)><div class=container><div class=row><div class=col-md-12><div class=block><h1>Testing Java Spring Boot Microservices</h1><p></p></div></div></div></div></section><section class=page-wrapper><div class=container><div class=row><div class=col-md-8><div class="post post-single"><h2 class=post-title>Testing Java Spring Boot Microservices</h2><div class=post-meta><ul><li><i class=ion-calendar></i> September 17, 2017</li><li><i class=ion-android-people></i>
Posted by
<a class=text-primary href=/author/nadia-humbert-labeaumaz>Nadia Humbert-Labeaumaz</a></li><li><i class=ion-pricetags></i>
<a href=/tags/software-testing>Software Testing</a>, <a href=/tags/software-design>Software Design</a>, <a href=/tags/java>Java</a></li></ul></div><div class=post-thumb><img class=img-responsive src=/images/blog/testing-microservices/header.jpg alt="Testing Java Spring Boot Microservices"></div><div class="post-content post-excerpt"><p>Tests are an essential part of our codebase. At the very least, they minimize the risk of regression when we modify our code. There are several types of tests, and each has a specific role: unit tests, integration tests, component tests, contract tests and end-to-end tests. Therefore, it is crucial to understand the role of each type of test to leverage its potential.</p><p>This article describes a strategy to use them to test Java Spring Boot microservices. It presents each type of test&rsquo;s role, scope, and tooling.</p><h2 id=anatomy-of-a-microservice>Anatomy of a Microservice</h2><p>A standard microservice is composed of the following:</p><ul><li><strong>Resources</strong>: HTTP controllers or AMQP listeners serving as the entry point of the microservice.</li><li><strong>Services/domain</strong>: Classes containing the business logic.</li><li><strong>Repositories</strong>: Classes exposing an API to access storage (like a database).</li><li><strong>Clients</strong>: HTTP clients or AMQP producers communicating with external resources.</li><li><strong>Gateways</strong>: Classes serving as interfaces between domain services and clients by handling HTTP or AMQP-related tasks and providing a clean API to the domain.</li></ul><h2 id=types-of-tests>Types of Tests</h2><h3 id=unit-tests>Unit Tests</h3><p>Unit tests allow testing a unit (generally a method) in isolation and are very cost-effective: easy to set up and fast. As a result, they can provide immediate feedback about the application&rsquo;s state to spot bugs or regressions. As a bonus, they help validate a design: if the code is difficult to test, the design is probably bad.</p><p>As a result, it&rsquo;s a good practice to test every edge case and suitable combination with unit tests.
In a microservice context, like in any other codebase, it&rsquo;s essential to unit test domain/service classes and every class containing logic.</p><p>The preferred tooling to write unit tests is <a href=http://junit.org/junit5/>Junit</a> (to run the tests), <a href=http://joel-costigliola.github.io/assertj/>AssertJ</a> (to write assertions) and <a href=http://site.mockito.org/>Mockito</a> (to mock external dependencies).</p><h3 id=integration-tests>Integration Tests</h3><p>Integration tests are used to test the proper integration of the different bricks of the application. However, they&rsquo;re sometimes hard to set up and have to be carefully chosen: the idea isn&rsquo;t to test all possible interactions but to choose relevant ones. And their feedback is less fast than the one with unit tests because they&rsquo;re slower to execute.</p><p>It&rsquo;s important to note that writing too many integration tests for the same interaction can be counter-productive. Indeed, the build time will increase without getting any added value.</p><p>In a microservice, it&rsquo;s relevant to write integration tests for:</p><ul><li><strong>Repositories</strong> &ndash; when the query is more complex than just a <code>findById</code>.</li><li><strong>Services</strong> &ndash; in case of doubt on the interaction between the service and repository (JPA or transaction issues, for instance).</li><li><strong>HTTP clients</strong>.</li><li><strong>Gateways</strong>.</li></ul><p>Spring Boot provides great tooling to write integration tests. A typical integration test with Spring Boot looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserGatewayIntTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserGateway userGateway;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The test must use the <code>SpringRunner</code> and be annotated with <code>@SpringBootTest</code>. It&rsquo;s then possible to inject a bean using <code>@Autowired</code> and mock one using <code>@MockBean</code>.
Also, the database should be embedded (the H2 database is a good candidate) for the integration tests to be executable anywhere. For the same reason, external HTTP resources can be mocked using <a href=http://wiremock.org/>WireMock</a> and an SMTP server with <a href=https://github.com/voodoodyne/subethasmtp>SubEthatSMTP</a>.</p><p>To mock external microservices, it&rsquo;s necessary to fix the port. In production, microservices will register themselves to a registry and dynamically get an URL assigned. In tests, you can fix the URL by adding a property to the test <code>application.yml</code> if <a href=https://github.com/Netflix/ribbon>Ribbon</a> is used with Spring Cloud (here, the external microservice name is <code>user</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>user</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ribbon</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>listOfServers</span>: <span style=color:#ae81ff>localhost:9999</span>
</span></span></code></pre></div><h3 id=component-tests>Component Tests</h3><p>Component tests allow testing complete use cases from end to end. However, they&rsquo;re often expensive in terms of setup and execution time. Thus, their scope must be carefully defined, as with integration tests. Nevertheless, these tests are necessary to check and document the application&rsquo;s or the microservice&rsquo;s overall behaviour.</p><p>In the context of microservices, component tests are very cost-effective. Indeed, they can be easy to set up because it&rsquo;s often possible to use the microservice&rsquo;s existing external API directly without needing additional elements (like a fake server). Moreover, the scope of a microservice is generally limited and can be tested exhaustively in isolation.</p><p>Component tests should be concise and easy to understand (see <a href=https://blog.crafties.fr/2017/09/16/how-to-write-robust-component-tests/>How to Write Robust Component Tests</a>). The goal is to test the microservice&rsquo;s behaviour by writing a nominal case and very few edge cases.
Note that writing the specification before implementing the feature can lead to straightforward component tests. Moreover, writing the component tests in collaboration with the different project stakeholders is good practice to cover the feature effectively.</p><p>An example of tooling we can use to write component tests is <a href=https://github.com/cucumber/cucumber/wiki/Gherkin>Gherkin</a> (to write the specifications) with <a href=https://cucumber.io/>Cucumber</a> (to run the tests).</p><p>In component tests, you can use an embedded database. Moreover, it&rsquo;s possible to mock HTTP and AMQP clients: this is not the place to test the integration with external resources (see <a href=https://blog.crafties.fr/2017/07/23/setup-a-circuit-breaker-with-hystrix/>Setup a Circuit Breaker with Hystrix, Feign Client and Spring Boot</a>).</p><p>To perform requests on the HTTP API of the microservice and make assertions on the response, <a href=https://blog.crafties.fr/2015/10/31/testing-spring-mvc-controllers/>MockMvc</a> can be used.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@WebAppConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ContextConfiguration</span>(classes <span style=color:#f92672>=</span> AppConfig.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StepDefs</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span> <span style=color:#66d9ef>private</span> WebApplicationContext context;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MockMvc mockMvc;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ResultActions actions;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Before</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        mockMvc <span style=color:#f92672>=</span> MockMvcBuilders.<span style=color:#a6e22e>webAppContextSetup</span>(context).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@When</span>(<span style=color:#e6db74>&#34;^I get \&#34;([^\&#34;]*)\&#34; on the application$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>iGetOnTheApplication</span>(String uri) <span style=color:#66d9ef>throws</span> Throwable {
</span></span><span style=display:flex><span>        actions <span style=color:#f92672>=</span> mockMvc.<span style=color:#a6e22e>perform</span>(get(uri));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Then</span>(<span style=color:#e6db74>&#34;^I get a Response with the status code (\\d+)$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>iGetAResponseWithTheStatusCode</span>(<span style=color:#66d9ef>int</span> statusCode) <span style=color:#66d9ef>throws</span> Throwable {
</span></span><span style=display:flex><span>        actions.<span style=color:#a6e22e>andExpect</span>(status().<span style=color:#a6e22e>is</span>(statusCode));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>To inject AMQP messages, the channel used by Spring Cloud Stream can also be injected directly into the test.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// AMQP listener code</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableBinding</span>(MyStream.<span style=color:#a6e22e>Process</span>.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyStream</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@StreamListener</span>(<span style=color:#e6db74>&#34;myChannel&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleRevision</span>(Message<span style=color:#f92672>&lt;</span>MyMessageDTO<span style=color:#f92672>&gt;</span> message) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// handle message</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Process</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Input</span>(<span style=color:#e6db74>&#34;myChannel&#34;</span>) SubscribableChannel <span style=color:#a6e22e>process</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Cucumber step definition</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StepDefs</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MyStream.<span style=color:#a6e22e>Process</span> myChannel;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@When</span>(<span style=color:#e6db74>&#34;^I publish an event with the following data:$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>iPublishAnEventWithTheFollowingData</span>(String payload) {
</span></span><span style=display:flex><span>        myChannel.<span style=color:#a6e22e>process</span>().<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> GenericMessage<span style=color:#f92672>&lt;&gt;</span>(payload));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, it may be important to fix the time to make tests more robust (see <a href=https://blog.crafties.fr/2017/07/20/controlling-time-in-java/>Controlling the Time in Java</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StepDefs</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span> <span style=color:#a6e22e>@MockBean</span> <span style=color:#66d9ef>private</span> ClockProvider clockProvider;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Given</span>(<span style=color:#e6db74>&#34;^The time is \&#34;([^\&#34;]*)\&#34;$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>theTimeIs</span>(String datetime) <span style=color:#66d9ef>throws</span> Throwable {
</span></span><span style=display:flex><span>        ZonedDateTime date <span style=color:#f92672>=</span> ZonedDateTime.<span style=color:#a6e22e>parse</span>(datetime);
</span></span><span style=display:flex><span>        when(clockProvider.<span style=color:#a6e22e>get</span>()).<span style=color:#a6e22e>thenReturn</span>(Clock.<span style=color:#a6e22e>fixed</span>(date.<span style=color:#a6e22e>toInstant</span>(), date.<span style=color:#a6e22e>getZone</span>()));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=contract-tests>Contract Tests</h3><p>The goal of contract tests is to automatically verify that the provider of a service and its consumers speak the same language. These tests don&rsquo;t aim to verify the behaviour of the components but simply their contracts. Moreover, they&rsquo;re handy for microservices since almost all their value lies in their interactions: it&rsquo;s crucial to guarantee that no provider breaks the contract used by its consumers.</p><p>The general idea is that consumers write tests that define the provider&rsquo;s initial state, the request sent by the consumer and the expected response. The provider must supply a server in the required state. The contract will automatically be verified against this server. This implies the following:</p><ul><li><strong>on the consumer side</strong>: contract tests are written using the HTTP client. Given a provider state, assertions are made on the HTTP response.</li><li><strong>on the provider side</strong>: only the HTTP resource should be instantiated. All its dependencies should be mocked to provide the required state.</li></ul><p>It&rsquo;s important to note that contract tests should stick to the consumer&rsquo;s real needs. In other words, if a consumer doesn&rsquo;t use a field, it shouldn&rsquo;t be tested in the contract test. And, then, the provider is free to update or delete every field that&rsquo;s not used by any consumer, and we&rsquo;re thus sure that if tests fail, it&rsquo;s for a good reason.</p><p>You can use <a href=https://docs.pact.io/>Pact</a> to write and execute contract tests. It&rsquo;s a very mature product with plugins for many languages (JVM, Ruby, .NET, Javascript, Go, Python, etc.). Moreover, it&rsquo;s well integrated with Spring MVC thanks to the <a href=https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-provider-spring>DiUS pact-jvm-provider-spring plugin</a>.
During the execution of the consumer tests, contracts (called pacts) are generated in JSON format. They can be shared with the provider using a service called the <a href=https://github.com/pact-foundation/pact_broker>Pact Broker</a>.</p><p>This is an example of a consumer test written with the <a href=https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-consumer-junit>DiUS pact-jvm-consumer-junit plugin</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>should_send_booking_request_and_get_rejection_response</span>() <span style=color:#66d9ef>throws</span> AddressException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    RequestResponsePact pact <span style=color:#f92672>=</span> ConsumerPactBuilder
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>consumer</span>(<span style=color:#e6db74>&#34;front-office&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>hasPactWith</span>(<span style=color:#e6db74>&#34;booking&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>given</span>(<span style=color:#e6db74>&#34;The hotel 1234 has no vacancy&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>uponReceiving</span>(<span style=color:#e6db74>&#34;a request to book a room&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>path</span>(<span style=color:#e6db74>&#34;/api/book&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>method</span>(<span style=color:#e6db74>&#34;POST&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>body</span>(<span style=color:#e6db74>&#34;{&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;\&#34;hotelId\&#34;: 1234, &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;\&#34;from\&#34;: \&#34;2017-09-01\&#34;, &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;\&#34;to\&#34;: \&#34;2017-09-16\&#34;&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;}&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>willRespondWith</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>status</span>(200)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>body</span>(<span style=color:#e6db74>&#34;{ \&#34;errors\&#34; : [ \&#34;There is no room available for this booking request.\&#34; ] }&#34;</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>toPact</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    PactVerificationResult result <span style=color:#f92672>=</span> runConsumerTest(pact, config, mockServer <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>        BookingResponse response <span style=color:#f92672>=</span> bookingClient.<span style=color:#a6e22e>send</span>(aBookingRequest());
</span></span><span style=display:flex><span>        assertThat(response.<span style=color:#a6e22e>getErrors</span>()).<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;There is no room available for this booking request.&#34;</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(PactVerificationResult.<span style=color:#a6e22e>Ok</span>.<span style=color:#a6e22e>INSTANCE</span>, result);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>On the server side:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(RestPactRunner.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Provider</span>(<span style=color:#e6db74>&#34;booking&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Consumer</span>(<span style=color:#e6db74>&#34;front-office&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PactBroker</span>(
</span></span><span style=display:flex><span>        host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${PACT_BROKER_HOST}&#34;</span>, port <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${PACT_BROKER_PORT}&#34;</span>, protocol <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${PACT_BROKER_PROTOCOL}&#34;</span>,
</span></span><span style=display:flex><span>        authentication <span style=color:#f92672>=</span> <span style=color:#a6e22e>@PactBrokerAuth</span>(username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${PACT_BROKER_USER}&#34;</span>, password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${PACT_BROKER_PASSWORD}&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BookingContractTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mock</span> <span style=color:#66d9ef>private</span> BookingService bookingService;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InjectMocks</span> <span style=color:#66d9ef>private</span> BookingResource bookingResource;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TestTarget</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> MockMvcTarget target <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MockMvcTarget();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() <span style=color:#66d9ef>throws</span> MessagingException, IOException {
</span></span><span style=display:flex><span>        initMocks(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        target.<span style=color:#a6e22e>setControllers</span>(bookingResource);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@State</span>(<span style=color:#e6db74>&#34;The hotel 1234 has no vacancy&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>should_have_no_vacancy</span>() {
</span></span><span style=display:flex><span>        when(bookingService.<span style=color:#a6e22e>book</span>(eq(1234L), any(), any())).<span style=color:#a6e22e>thenReturn</span>(BookingResult.<span style=color:#a6e22e>NO_VACANCY</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=end-to-end-tests>End-to-End Tests</h3><p>End-to-end tests need the whole platform to be up and running to run entire business use cases across multiple microservices. Unfortunately, they&rsquo;re costly and slow to run. These tests can be performed manually or automatically on a dedicated platform but have to be chosen strategically to maximize their benefits.</p><h2 id=to-sum-up>To Sum Up</h2><p><div class=text-center><figure><img src=/images/blog/testing-microservices/strategy.png alt="Testing strategy"><figcaption><h5 class=font-weight-bold></h5></figcaption></figure></div></p><h2 id=conclusion>Conclusion</h2><p>Automatic tests are essential in the software development industry. A good testing strategy can help write more relevant, robust and maintainable tests. This article describes an example of a strategy to test Java Spring Boot microservices.</p></div><div class=post-comments></div></div></div><div class=col-md-4><aside class=sidebar><div class="widget widget-latest-post"><h4 class=widget-title>Latest Posts</h4><div class=media><a class=pull-left href=/blog/2021/04/28/effecting-long-lasting-changes/><img class=media-object src=/images/blog/effecting-long-lasting-changes/header.jpg alt="How to Effect Long-Lasting Organisational Changes"></a><div class=media-body><h4 class=media-heading><a href=/blog/2021/04/28/effecting-long-lasting-changes/>How to Effect Long-Lasting Organisational Changes</a></h4></div></div><div class=media><a class=pull-left href=/blog/2021/01/14/what-is-a-social-entrepreneur/><img class=media-object src=/images/blog/what-is-a-social-entrepreneur/header.jpg alt="What is a Social Entrepreneur?"></a><div class=media-body><h4 class=media-heading><a href=/blog/2021/01/14/what-is-a-social-entrepreneur/>What is a Social Entrepreneur?</a></h4></div></div><div class=media><a class=pull-left href=/blog/2020/07/05/debt-sme-nz/><img class=media-object src=/images/blog/debt-sme-nz/header.jpg alt="Debt and SMEs in New Zealand"></a><div class=media-body><h4 class=media-heading><a href=/blog/2020/07/05/debt-sme-nz/>Debt and SMEs in New Zealand</a></h4></div></div><div class=media><a class=pull-left href=/blog/2019/06/27/cloudy-relationship-france-diesel/><img class=media-object src=/images/blog/diesel/header.jpg alt="The Cloudy Relationship Between France and Diesel"></a><div class=media-body><h4 class=media-heading><a href=/blog/2019/06/27/cloudy-relationship-france-diesel/>The Cloudy Relationship Between France and Diesel</a></h4></div></div></div><div class="widget widget-category"><h4 class=widget-title>Categories</h4><ul class=widget-category-list><li><a href=/categories/business/>Business</a></li><li><a href=/categories/case-studies/>Case Studies</a></li><li><a href=/categories/software/>Software</a></li></ul></div><div class="widget widget-tag"><h4 class=widget-title>Tags</h4><ul class=widget-tag-list><li><a href=/tags/change-management/>Change Management</a></li><li><a href=/tags/economics/>Economics</a></li><li><a href=/tags/finance/>Finance</a></li><li><a href=/tags/java/>Java</a></li><li><a href=/tags/refactoring/>Refactoring</a></li><li><a href=/tags/social-entrepreneurship/>Social Entrepreneurship</a></li><li><a href=/tags/software-design/>Software Design</a></li><li><a href=/tags/software-testing/>Software Testing</a></li></ul></div></aside></div></div></div></section><footer class=footer><div class=container><div class=row><div class=col-md-12><div class=footer-menu><ul><li><a href=/>Home</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Articles</a></li></ul></div><div class=footer-menu><ul><li><a href=https://www.linkedin.com/in/nadia-humbert-labeaumaz/ target=_blank><i class=ion-social-linkedin-outline></i></a></li><li><a href=https://github.com/nphumbert target=_blank><i class=ion-social-github-outline></i></a></li><li><a href=https://twitter.com/nphumbert target=_blank><i class=ion-social-twitter-outline></i></a></li></ul></div><p class=copyright></p></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script><script src=/plugins/bootstrap/js/bootstrap.min.js></script><script src=/plugins/slick/slick.min.js></script><script src=/plugins/magnific-popup/magnific-popup.min.js></script><script src=/plugins/shuffle/shuffle.min.js></script><script src=/plugins/google-map/gmap.js defer></script><script src=/js/script.min.js></script></body></html>