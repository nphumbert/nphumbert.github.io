<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Spring Security et Spring Boot</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Entrepreneur, consultant, bio-sciences and software engineer."><meta name=author content="Nadia Humbert-Labeaumaz"><meta name=generator content="Hugo 0.131.0"><meta property="og:image" content="https://nphumbert.github.io/images/blog/spring-security/header.jpg"><meta property="og:url" content="https://nphumbert.github.io/blog/2015/06/21/spring-security-et-spring-boot/"><meta property="og:site_name" content="Nadia Humbert-Labeaumaz"><meta property="og:title" content="Spring Security et Spring Boot"><meta property="og:description" content="Depuis Spring 3.1, il est possible de configurer Spring en Java. La configuration Java de Spring Security est supportée depuis sa version 3.2 (source).
L’objectif de cet article est de montrer comment configurer Spring Security en Java config, dans une application Spring Boot, avec une base de données qui contient les utilisateurs et leur mot de passe hashé. De plus, une authentification HTTP basic sera mise en place."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2015-06-21T11:51:37+02:00"><meta property="article:modified_time" content="2015-06-21T11:51:37+02:00"><meta property="article:tag" content="Java"><meta property="og:image" content="https://nphumbert.github.io/images/slider.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nphumbert.github.io/images/slider.jpg"><meta name=twitter:title content="Spring Security et Spring Boot"><meta name=twitter:description content="Depuis Spring 3.1, il est possible de configurer Spring en Java. La configuration Java de Spring Security est supportée depuis sa version 3.2 (source).
L’objectif de cet article est de montrer comment configurer Spring Security en Java config, dans une application Spring Boot, avec une base de données qui contient les utilisateurs et leur mot de passe hashé. De plus, une authentification HTTP basic sera mise en place."><script async src="https://www.googletagmanager.com/gtag/js?id=G-FDXGPB3FE3"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FDXGPB3FE3")}</script><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css media=screen><link rel=stylesheet href=/plugins/ionicons/css/ionicons.min.css><link rel=stylesheet href=/plugins/magnific-popup/magnific-popup.min.css><link rel=stylesheet href=/plugins/slick/slick.css><link rel=stylesheet href=/scss/style.min.css media=screen><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=icon href=/images/favicon.png type=image/x-icon><link rel=canonical href=https://nphumbert.github.io/blog/2015/06/21/spring-security-et-spring-boot/></head><body><div class=preloader></div><header class=navigation><div class=container><div class=row><div class=col-md-12><nav class=navbar><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navigation>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse" id=navigation><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Articles</a></li></ul></div></nav></div></div></div></header><section class="page-title bg-2" style=background-image:url(/images/blog/spring-security/header.jpg)><div class=container><div class=row><div class=col-md-12><div class=block><h1>Spring Security et Spring Boot</h1><p></p></div></div></div></div></section><section class=page-wrapper><div class=container><div class=row><div class=col-md-8><div class="post post-single"><h2 class=post-title>Spring Security et Spring Boot</h2><div class=post-meta><ul><li><i class=ion-calendar></i> June 21, 2015</li><li><i class=ion-android-people></i>
Posted by
<a class=text-primary href=/author/nadia-humbert-labeaumaz>Nadia Humbert-Labeaumaz</a></li><li><i class=ion-pricetags></i>
<a href=/tags/java>Java</a></li></ul></div><div class=post-thumb><img class=img-responsive src=/images/blog/spring-security/header.jpg alt="Spring Security et Spring Boot"></div><div class="post-content post-excerpt"><p>Depuis Spring 3.1, il est possible de configurer Spring en Java.
La configuration Java de Spring Security est supportée depuis sa version 3.2 (<a href=http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#jc>source</a>).</p><p>L&rsquo;objectif de cet article est de montrer comment configurer Spring Security en Java config, dans une application Spring Boot, avec une base de données qui contient les utilisateurs et leur mot de passe hashé. De plus, une authentification HTTP basic sera mise en place.</p><h2 id=créer-la-classe-de-configuration>Créer la classe de configuration</h2><p>La classe Java qui doit gérer la configuration doit être munie de l&rsquo;annotation <code>@Configuration</code> définie par Spring. De plus, elle doit étendre la classe <code>WebSecurityConfigurerAdapter</code>. Spring Boot mettant en place une configuration par défaut, il faut donc finalement utiliser l&rsquo;annotation <code>@Order</code> afin d&rsquo;indiquer que la nouvelle configuration doit être utilisée.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Order</span>(SecurityProperties.<span style=color:#a6e22e>ACCESS_OVERRIDE_ORDER</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfiguration</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=configurer-spring-security-pour-utiliser-une-base-de-données>Configurer Spring Security pour utiliser une base de données</h2><p>Pour indiquer à Spring la méthode d&rsquo;authentification, il faut redéfinir la méthode <code>configure(AuthenticationManagerBuilder)</code>. Spring Security offre une API <em>fluent</em> pour configurer une authentification à partir de l&rsquo;objet <code>AuthenticationManagerBuilder</code>.</p><p>Le code ci-dessous permet de configurer l&rsquo;authentification en utilisant une base de données.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Order</span>(SecurityProperties.<span style=color:#a6e22e>ACCESS_OVERRIDE_ORDER</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfiguration</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DataSource dataSource; <span style=color:#75715e>// 3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(AuthenticationManagerBuilder auth) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        auth.<span style=color:#a6e22e>jdbcAuthentication</span>() <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>passwordEncoder</span>(<span style=color:#66d9ef>new</span> ShaPasswordEncoder(256)) <span style=color:#75715e>// 6</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>dataSource</span>(dataSource) <span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>usersByUsernameQuery</span>(<span style=color:#e6db74>&#34;SELECT login, password, active FROM user WHERE login=?&#34;</span>) <span style=color:#75715e>// 4</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authoritiesByUsernameQuery</span>(<span style=color:#e6db74>&#34;SELECT login, role FROM user WHERE login=?&#34;</span>); <span style=color:#75715e>// 5</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Dans le cadre de cet article, il s&rsquo;agit d&rsquo;une authentification JDBC (<code>1</code>). La base de données à laquelle Spring doit accéder est accessible via une <code>dataSource</code> (<code>2</code>). Elle a été configurée dans l&rsquo;application (typiquement dans <code>application.properties</code>) et peut donc être directement injectée par Spring grâce à l&rsquo;annotation <code>@Autowired</code> (<code>3</code>).</p><p>La requête pour récupérer un utilisateur à partir de son login est fournie via la méthode <code>usersByUsernameQuery</code> (<code>4</code>) et celle pour récupérer les rôles d&rsquo;un utilisateur à partir de son login via la méthode <code>authoritiesByUsernameQuery</code> (<code>5</code>). Un utilisateur est caractérisé par un login, un mot de passe et un booléen indiquant s&rsquo;il est actif. Un rôle est une chaîne de caractères qui correspondra à un profil ayant un ensemble de droits.</p><p>Finalement, il est indiqué que les mots de passe dans la base sont hashés à l&rsquo;aide de l&rsquo;agorithme SHA-256 (<code>6</code>).</p><h2 id=configuration-de-lauthentification-http-basic>Configuration de l&rsquo;authentification HTTP basic</h2><p>La méthode d&rsquo;authentification <a href=https://fr.wikipedia.org/wiki/Authentification_HTTP#M.C3.A9thode_.C2.AB_Basic_.C2.BB>HTTP basic</a> est une méthode d&rsquo;authentification simple en HTTP et sera utilisée dans cet article.
Cette méthode est indiquée en surchargeant la méthode <code>configure(HTTPSecurity)</code>. De même que dans la section précédente, Spring Security offre une API <em>fluent</em> pour configurer une authentification HTTP à partir de l&rsquo;objet <code>HTTPSecurity</code>.</p><p>Le code ci-dessous permet de configurer l&rsquo;authentification HTTP basic.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>    http.<span style=color:#a6e22e>httpBasic</span>() <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authorizeRequests</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#e6db74>&#34;/css/**&#34;</span>, <span style=color:#e6db74>&#34;/js/**&#34;</span>).<span style=color:#a6e22e>permitAll</span>() <span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>anyRequest</span>().<span style=color:#a6e22e>authenticated</span>() <span style=color:#75715e>// 3</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>formLogin</span>()
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>loginPage</span>(<span style=color:#e6db74>&#34;/login&#34;</span>).<span style=color:#a6e22e>permitAll</span>() <span style=color:#75715e>// 4</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>               .<span style=color:#a6e22e>logout</span>()
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>logoutUrl</span>(<span style=color:#e6db74>&#34;/logout&#34;</span>) <span style=color:#75715e>// 5</span>
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>logoutSuccessUrl</span>(<span style=color:#e6db74>&#34;/&#34;</span>); <span style=color:#75715e>// 6</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>La méthode d&rsquo;authentification HTTP est précisée avec la méthode <code>httpBasic</code> (<code>1</code>). La racine, les fichiers CSS et javascript sont accessibles à tout le monde (<code>2</code>) tandis que toutes les autres requêtes nécessitent d&rsquo;être authentifié (<code>3</code>).</p><p>L&rsquo;URL de login est spécifiée via la méthode <code>loginPage</code> (<code>4</code>) et celle de logout via la méthode <code>logoutUrl</code> (<code>5</code>). Après la déconnexion, l&rsquo;utilisateur est redirigé vers la racine (<code>6</code>).</p><p>Le code suivant illustre un formulaire de login et un formulaire de logout.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- Formulaire de login --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/login&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> /&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> /&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;Login&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- Formulaire de logout --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/logout&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;Logout&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>La configuration de Spring Security en Java config est relativement simple et directe. Elle permet de contrôler et de centraliser les accès à toutes les URL de l&rsquo;application. De plus, il est possible de définir très simplement les URL de login et de logout, Spring Security se chargeant des traitements des requêtes.</p></div><div class=post-comments></div></div></div><div class=col-md-4><aside class=sidebar><div class="widget widget-latest-post"><h4 class=widget-title>Latest Posts</h4><div class=media><a class=pull-left href=/blog/2021/04/28/effecting-long-lasting-changes/><img class=media-object src=/images/blog/effecting-long-lasting-changes/header.jpg alt="How to Effect Long-Lasting Organisational Changes"></a><div class=media-body><h4 class=media-heading><a href=/blog/2021/04/28/effecting-long-lasting-changes/>How to Effect Long-Lasting Organisational Changes</a></h4></div></div><div class=media><a class=pull-left href=/blog/2021/01/14/what-is-a-social-entrepreneur/><img class=media-object src=/images/blog/what-is-a-social-entrepreneur/header.jpg alt="What is a Social Entrepreneur?"></a><div class=media-body><h4 class=media-heading><a href=/blog/2021/01/14/what-is-a-social-entrepreneur/>What is a Social Entrepreneur?</a></h4></div></div><div class=media><a class=pull-left href=/blog/2020/07/05/debt-sme-nz/><img class=media-object src=/images/blog/debt-sme-nz/header.jpg alt="Debt and SMEs in New Zealand"></a><div class=media-body><h4 class=media-heading><a href=/blog/2020/07/05/debt-sme-nz/>Debt and SMEs in New Zealand</a></h4></div></div><div class=media><a class=pull-left href=/blog/2019/06/27/cloudy-relationship-france-diesel/><img class=media-object src=/images/blog/diesel/header.jpg alt="The Cloudy Relationship Between France and Diesel"></a><div class=media-body><h4 class=media-heading><a href=/blog/2019/06/27/cloudy-relationship-france-diesel/>The Cloudy Relationship Between France and Diesel</a></h4></div></div></div><div class="widget widget-category"><h4 class=widget-title>Categories</h4><ul class=widget-category-list><li><a href=/categories/business/>Business</a></li><li><a href=/categories/case-studies/>Case Studies</a></li><li><a href=/categories/software/>Software</a></li></ul></div><div class="widget widget-tag"><h4 class=widget-title>Tags</h4><ul class=widget-tag-list><li><a href=/tags/change-management/>Change Management</a></li><li><a href=/tags/economics/>Economics</a></li><li><a href=/tags/finance/>Finance</a></li><li><a href=/tags/java/>Java</a></li><li><a href=/tags/refactoring/>Refactoring</a></li><li><a href=/tags/social-entrepreneurship/>Social Entrepreneurship</a></li><li><a href=/tags/software-design/>Software Design</a></li><li><a href=/tags/software-testing/>Software Testing</a></li></ul></div></aside></div></div></div></section><footer class=footer><div class=container><div class=row><div class=col-md-12><div class=footer-menu><ul><li><a href=/>Home</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Articles</a></li></ul></div><div class=footer-menu><ul><li><a href=https://www.linkedin.com/in/nadia-humbert-labeaumaz/ target=_blank><i class=ion-social-linkedin-outline></i></a></li><li><a href=https://github.com/nphumbert target=_blank><i class=ion-social-github-outline></i></a></li><li><a href=https://twitter.com/nphumbert target=_blank><i class=ion-social-twitter-outline></i></a></li></ul></div><p class=copyright></p></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script><script src=/plugins/bootstrap/js/bootstrap.min.js></script><script src=/plugins/slick/slick.min.js></script><script src=/plugins/magnific-popup/magnific-popup.min.js></script><script src=/plugins/shuffle/shuffle.min.js></script><script src=/plugins/google-map/gmap.js defer></script><script src=/js/script.min.js></script></body></html>